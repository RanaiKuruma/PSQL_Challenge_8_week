-- Example datasets 
-- 1 sales 
-- 2 menu
-- 3 members
-- schema : dannys_diner 

-- Table-1
-- Sales 
-- 3 columns : customer_id, order_date, product_id
-- Table-2 
-- menu 
-- 3 columns : product_id, product_name, price 
-- Table- 3 
-- members
-- 2 columns : customer_id, join_date 

-- Case Study Questions 
-- 1 What is the total amount each customer spent at the restaurant?
SELECT 
  customer_id,
  SUM(t2.price) AS amt_spent_each_customer
FROM dannys_diner.sales AS t1 
INNER JOIN dannys_diner.menu AS t2 
  ON t1.product_id = t2.product_id
GROUP BY customer_id
ORDER BY amt_spent_each_customer DESC;

-- 2 How many days has each customer visited the restaurant?
SELECT 
  customer_id,
  COUNT(DISTINCT order_date) AS customer_day_count
FROM dannys_diner.sales
GROUP BY customer_id
ORDER BY customer_day_count DESC;

-- 3 What was the first item from the menu purchased by each customer?
WITH ordered_sales AS (
SELECT 
  customer_id,
  RANK() OVER (
    PARTITION BY customer_id
    ORDER BY order_date
  ) AS order_rank,
  product_name
FROM dannys_diner.sales AS t1 
INNER JOIN dannys_diner.menu AS t2 
  ON t1.product_id = t2.product_id
)
SELECT  DISTINCT 
  customer_id,
  product_name
FROM ordered_sales
WHERE order_rank = 1;

